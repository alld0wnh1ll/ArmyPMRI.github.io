<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Check-In - PMRI Army Officer Resource Hub</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
</head>
<body>
    <div class="header">
        <h1>Check-In</h1>
        <button id="menuToggle" class="menu-toggle">
            <i class="fas fa-bars"></i>
        </button>
    </div>

    <div class="content">
        <div class="introduction">
            <h2>Daily Check-In</h2>
            <p>
                Use this form to check in for the day. Your location and timestamp will be automatically recorded.
            </p>
        </div>

        <div class="checkin-section">
            <div class="checkin-form-container">
                <form id="checkinForm" class="checkin-form">
                    <div class="form-group">
                        <label for="name">Full Name:</label>
                        <input type="text" id="name" name="name" required autocomplete="name">
                    </div>
                    
                    <div class="form-group">
                        <label for="location">Location:</label>
                        <div class="location-input-group">
                            <input type="text" id="location" name="location" readonly>
                            <button type="button" id="refreshLocation" class="refresh-location">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="timestamp">Time:</label>
                        <input type="text" id="timestamp" name="timestamp" readonly>
                    </div>

                    <button type="submit" class="checkin-button">
                        <i class="fas fa-check"></i>
                        Check In
                    </button>
                </form>
            </div>

            <div id="checkinHistory" class="checkin-history">
                <div id="loginSection" class="login-section">
                    <div class="login-container">
                        <h3>Admin Access Required</h3>
                        <p class="auth-info">Please login with GitHub to view check-in history.</p>
                        <div class="auth-button">
                            <a href="https://github.com/login/oauth/authorize?client_id=Ov23liX1MnlJlSbM5gbX&redirect_uri=https://alld0wnh1ll.github.io/checkin.html&scope=repo" class="github-auth-button">
                                <i class="fab fa-github"></i>
                                Login with GitHub
                            </a>
                        </div>
                    </div>
                </div>
                <div id="historyContent" style="display: none;">
                    <h3>Recent Check-Ins</h3>
                    <div id="historyList"></div>
                </div>
            </div>
        </div>

        <div class="sidebar" id="sidebar">
            <ul>
                <li><a href="index.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="resources.html"><i class="fas fa-book"></i> Military & Academic Resources</a></li>
                <li><a href="faq.html"><i class="fas fa-question-circle"></i> FAQ</a></li>
                <li><a href="contacts.html"><i class="fas fa-address-book"></i> Contacts</a></li>

            </ul>
        </div>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        // Load configuration
        const config = require('./config.js');
        
        // Initialize map with API key from config
        function initMap() {
            const map = new google.maps.Map(document.getElementById('map'), {
                zoom: 15,
                center: { lat: 40.4237, lng: -86.9212 }, // Purdue coordinates
                styles: [
                    {
                        "featureType": "all",
                        "elementType": "geometry",
                        "stylers": [{"color": "#242f3e"}]
                    },
                    {
                        "featureType": "all",
                        "elementType": "labels.text.stroke",
                        "stylers": [{"lightness": -80}]
                    },
                    {
                        "featureType": "administrative",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#746855"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "geometry",
                        "stylers": [{"color": "#2b3544"}]
                    },
                    {
                        "featureType": "road",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#9ca5b3"}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "geometry",
                        "stylers": [{"color": "#746855"}]
                    },
                    {
                        "featureType": "road.highway",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#f3d19c"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "geometry",
                        "stylers": [{"color": "#17263c"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels.text.fill",
                        "stylers": [{"color": "#515c6d"}]
                    },
                    {
                        "featureType": "water",
                        "elementType": "labels.text.stroke",
                        "stylers": [{"lightness": -20}]
                    }
                ]
            });
        }

        // Update form submission to use environment variables
        document.getElementById('checkinForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = new FormData(this);
            const data = {
                name: formData.get('name'),
                rank: formData.get('rank'),
                branch: formData.get('branch'),
                location: formData.get('location'),
                timestamp: new Date().toISOString()
            };

            try {
                const response = await fetch('/api/checkin', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${config.API_KEY}`
                    },
                    body: JSON.stringify(data)
                });

                if (response.ok) {
                    showToast('Check-in successful!');
                    updateHistory();
                } else {
                    throw new Error('Check-in failed');
                }
            } catch (error) {
                console.error('Error:', error);
                showToast('Check-in failed. Please try again.');
            }
        });
    </script>
</body>
</html>